<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Checklist</title>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Favicons -->
    <link href="/img/favicon.ico" rel="icon" />
    <link href="/img/apple-touch-icon.png" rel="apple-touch-icon" />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />

    <!-- Sticky footer CSS -->
    <link rel="stylesheet" href="./css/site.css" />

    <!-- Prism -->
    <link rel="stylesheet" href="/css/prism-twilight.css" />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"
      integrity="sha384-SZXxX4whJ79/gErwcOYf+zWLeJdY/qpuqC4cAa9rOGUstPomtqpuNWT9wdPEn2fk"
      crossorigin="anonymous"
    />
  </head>

  <body>
    <header>
      <!-- Fixed navbar -->
      <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <a class="navbar-brand" id="logo" href="index.html">Coding Challenge</a>
        <button
          class="navbar-toggler"
          type="button"
          data-toggle="collapse"
          data-target="#navbarCollapse"
          aria-controls="navbarCollapse"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="app.html">The App</a>
            </li>
            <li class="nav-item active">
              <a class="nav-link" href="code.html"
                >See The Code <span class="sr-only">(current)</span></a
              >
            </li>

            <li class="nav-item">
              <a
                class="nav-link"
                href="https://github.com/mister-josuecedeno/mortgage-calculator"
                target="_blank"
                >Get The Code</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="about.html">About The Developer</a>
            </li>
            <!-- <li class="nav-item">
            <a class="nav-link disabled" href="#">Disabled</a>
          </li> -->
          </ul>
          <!-- <form class="form-inline mt-2 mt-md-0">
          <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
          <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form> -->
        </div>
      </nav>
    </header>

    <!-- Begin page content -->
    <main role="main">
      <!-- Add HTML later -->
      <div class="container mt-5">
        <!-- Card -->
        <div class="row">
          <div class="col">
            <!-- Try a card -->
            <div class="card mt-5 shadow bg-dark bg-opacity">
              <!-- <img class="card-img-top" src="holder.js/100x180/" alt=""> -->
              <div class="card-body">
                <h4 class="card-title border-bottom p-1">
                  &lt;/&gt; Code Review
                </h4>
                <!-- Introduction -->
                <section>
                  <p class="text-white">
                    The application manages tasks using the following function
                    groups:
                  </p>
                  <ul class="text-light">
                    <li>Data Management</li>
                    <ol>
                      <li>Build Checklist</li>
                    </ol>
                    <li>Business Logic</li>

                    <ol>
                      <li>Add Tasks</li>
                      <li>Mark Tasks as Complete / Incomplete</li>
                      <li>Delete Tasks</li>
                    </ol>

                    <li>Data Display</li>
                  </ul>
                  <h6 class="card-text ml-1 mb-3 text-white">
                    Click the section links below to learn more about the code.
                  </h6>
                </section>

                <!-- Collapsible Sections -->
                <div class="accordion" id="accordionChecklist">
                  <!-- Data Management -->
                  <div class="card">
                    <div class="card-header" id="headingOne">
                      <h2 class="mb-0">
                        <button
                          class="btn btn-link"
                          type="button"
                          data-toggle="collapse"
                          data-target="#collapseBuildChecklist"
                          aria-expanded="true"
                          aria-controls="collapseBuildChecklist"
                        >
                          Build Checklist
                        </button>
                      </h2>
                    </div>

                    <div
                      id="collapseBuildChecklist"
                      class="collapse show"
                      aria-labelledby="headingOne"
                      data-parent="#accordionChecklist"
                    >
                      <div class="card-body">
                        <h5>Build Checklist</h5>
                        <p class="mb-3">
                          This function is the trigger point of the application.
                          Helper functions (<strong>getLocalStorage</strong>,
                          <strong>setLocalStorage</strong>) are used to access
                          local storage.
                        </p>
                        <p>
                          <span class="badge badge-info">Lines 8 - 10</span>
                          Return seed data for testing purposes
                        </p>
                        <p>
                          <span class="badge badge-info">Line 13</span>
                          The variable <strong>modelData</strong> is the focal
                          point of the application as it the holding space for
                          display data.
                        </p>

                        <!-- Start Code -->
                        <pre
                          class="line-numbers"
                        ><code class="language-javascript">// Build Checklist
function buildList() {
  // Change source to LocalStorage
  // Use seed data if local storage is empty (for testing only)
  let local = getLocalStorage();

  // This for TESTING PURPOSE (Comment out later)
  if (local.length === 0) {
    setLocalStorage(seedData);
    local = getLocalStorage();
  }

  modelData = local;

  displayData(modelData);
}
</code></pre>
                        <!-- End Code -->

                        <!-- Start Code -->
                        <pre
                          class="line-numbers"
                        ><code class="language-javascript">// Get Local Storage
function getLocalStorage() {
  return JSON.parse(localStorage.getItem('taskArray')) || [];
}
</code></pre>
                        <!-- End Code -->

                        <!-- Start Code -->
                        <pre
                          class="line-numbers"
                        ><code class="language-javascript">// Set Local Storage
function setLocalStorage(array) {
  localStorage.setItem('taskArray', JSON.stringify(array));
}
</code></pre>
                        <!-- End Code -->
                      </div>
                    </div>
                  </div>

                  <!-- Add Task -->
                  <div class="card">
                    <div class="card-header" id="headingTwo">
                      <h2 class="mb-0">
                        <button
                          class="btn btn-link collapsed"
                          type="button"
                          data-toggle="collapse"
                          data-target="#collapseAddTask"
                          aria-expanded="false"
                          aria-controls="collapseAddTask"
                        >
                          Add Task
                        </button>
                      </h2>
                    </div>
                    <div
                      id="collapseAddTask"
                      class="collapse"
                      aria-labelledby="headingTwo"
                      data-parent="#accordionChecklist"
                    >
                      <div class="card-body">
                        <h5>Add Task</h5>

                        <p class="mb-3">
                          The Add Task function creates an object which is then
                          pushed to the task array. The array is then saved to
                          local storage.
                        </p>
                        <p>
                          <span class="badge badge-info">Lines 20 - 23</span>
                          Both date fields use a helper function
                          (<strong>setDateTime</strong>) to adjust for the
                          impact of time.
                        </p>

                        <!-- Start Code -->
                        <pre
                          class="line-numbers"
                        ><code class="language-javascript">// Add Task
function addTask() {

  // Get array from local storage
  const tasks = getLocalStorage();

  // Task Object
  const task = {};

  // Set complete to false
  task['complete'] = false;

  //     Get UUID
  task['id'] = getUUID();

  // Retrieve task from modal form
  task['task'] = document.getElementById('newTask').value;

  //     Generate Today's Date - https://stackoverflow.com/questions/3894048/what-is-the-best-way-to-initialize-a-javascript-date-to-midnight
  task['createdDate'] = setDateTime(new Date());

  // Retrieve Due Date from Form
  task['dueDate'] = setDateTime(document.getElementById('newDueDate').value);

  // Push to array
  tasks.push(task);

  // Set array in local storage
  setLocalStorage(tasks);

  // Set modelData to new data
  modelData = getLocalStorage();

  // Reset form
  document.getElementById('newTaskForm').reset();

  // Display Data
  displayData(modelData);
}
</code></pre>
                        <!-- End Code -->

                        <!-- Start Code -->
                        <pre
                          class="line-numbers"
                        ><code class="language-javascript">// Set Date and Time
function setDateTime(dateInput) {
  let date = dateInput;
  let mthAdjust = 1;

  if (typeof dateInput === 'string') {
    let [year, month, day] = dateInput.split('-');
    mthAdjust = 0;
    date = new Date(year, month, day);
  }

  const day = date.getDate(); // Returns the date
  const month = date.getMonth() + mthAdjust; // Returns the month (adjusted based on type - string or object)
  const year = date.getFullYear(); // Returns the year
  return `${month}/${day}/${year}`;
}
</code></pre>
                        <!-- End Code -->
                      </div>
                    </div>
                  </div>

                  <!-- Mark Task as Complete / Incomplete -->
                  <div class="card">
                    <div class="card-header" id="headingThree">
                      <h2 class="mb-0">
                        <button
                          class="btn btn-link collapsed"
                          type="button"
                          data-toggle="collapse"
                          data-target="#collapseTaskComplete"
                          aria-expanded="false"
                          aria-controls="collapseTaskComplete"
                        >
                          Mark Task as Complete / Incomplete
                        </button>
                      </h2>
                    </div>
                    <div
                      id="collapseTaskComplete"
                      class="collapse"
                      aria-labelledby="headingThree"
                      data-parent="#accordionChecklist"
                    >
                      <div class="card-body">
                        <h5>Mark Task as Complete / Incomplete</h5>
                        <p class="mb-3">
                          Using the helper function (<strong>getId</strong>) the
                          array object is retrieved. It is then updated and
                          returned to local storage.
                        </p>
                        <p>
                          <span class="badge badge-info">Line 15</span>
                          The object id is retrieved.
                        </p>
                        <p>
                          <span class="badge badge-info">Line 21</span>
                          The object id is updated.
                        </p>

                        <!-- Start Code -->
                        <pre
                          class="line-numbers"
                        ><code class="language-javascript">// Mark as Complete / Incomplete
function toggleComplete(e) {
  let isComplete;

  if (e.checked) {
    isComplete = true;
  } else {
    isComplete = false;
  }

  // Get Tasks
  let tasks = getLocalStorage();

  // Task Id
  let taskId = getId(e);

  // Find where id matches Task ID
  let task = tasks.find((t) => t.id === taskId);

  // Update object element
  task.complete = isComplete;

  // Set Array
  setLocalStorage(tasks);
  displayData(getLocalStorage());
}        
</code></pre>
                        <!-- End Code -->

                        <!-- Start Code -->
                        <pre
                          class="line-numbers"
                        ><code class="language-javascript">// Helper function
function getId(e) {
  return e.parentElement.parentElement.children[1].innerText;
}        
</code></pre>
                        <!-- End Code -->
                      </div>
                    </div>
                  </div>

                  <!-- Delete Task -->
                  <div class="card">
                    <div class="card-header" id="headingFour">
                      <h2 class="mb-0">
                        <button
                          class="btn btn-link collapsed"
                          type="button"
                          data-toggle="collapse"
                          data-target="#collapseDeleteTask"
                          aria-expanded="false"
                          aria-controls="collapseDeleteTask"
                        >
                          Delete Tasks
                        </button>
                      </h2>
                    </div>
                    <div
                      id="collapseDeleteTask"
                      class="collapse"
                      aria-labelledby="headingFour"
                      data-parent="#accordionChecklist"
                    >
                      <div class="card-body">
                        <h5>Delete Tasks</h5>
                        <p class="mb-3">
                          Similar to Mark Task as Complete, the
                          <strong>getId</strong> was used to retrieve the task
                          selected.
                        </p>
                        <p>
                          <span class="badge badge-info">Line 12</span>
                          The array <strong>filter</strong> method is used to
                          retrieve all tasks, excluding the selected task. These
                          tasks are then returned to the array in local storage.
                        </p>

                        <!-- Start Code -->
                        <pre
                          class="line-numbers"
                        ><code class="language-javascript">// Delete Tasks
function deleteTask(e) {
  console.log('Delete me!');

  // Get Tasks
  let tasks = getLocalStorage();

  // Task Id
  let taskId = getId(e);

  // Find where id matches Task ID
  let tasksfiltered = tasks.filter((t) => t.id !== taskId);

  // Set Array
  setLocalStorage(tasksfiltered);
  displayData(getLocalStorage());
}                          
</code></pre>
                        <!-- End Code -->
                      </div>
                    </div>
                  </div>

                  <!-- Display Data -->
                  <div class="card">
                    <div class="card-header" id="headingFive">
                      <h2 class="mb-0">
                        <button
                          class="btn btn-link collapsed"
                          type="button"
                          data-toggle="collapse"
                          data-target="#collapseDisplayData"
                          aria-expanded="false"
                          aria-controls="collapseDisplayData"
                        >
                          Display Data
                        </button>
                      </h2>
                    </div>
                    <div
                      id="collapseDisplayData"
                      class="collapse"
                      aria-labelledby="headingFive"
                      data-parent="#accordionChecklist"
                    >
                      <div class="card-body">
                        <h5>Display Data</h5>
                        <p class="mb-3">
                          Templates are used to pull the data and dynamically
                          populate the HTML. This technique is particularly
                          powerful as it keeps the HTML out of the Javascript.
                          In addition, a helper function
                          (<strong>formatDate</strong>) is used for date
                          clean-up
                        </p>
                        <p>
                          <span class="badge badge-info">Lines 3 and 4</span>
                          Identifies the template and the code destination.
                        </p>
                        <p>
                          <span class="badge badge-info">Line 10</span> In the
                          for loop a copy of the template is populated with data
                          then appended to the target destination.
                        </p>

                        <!-- Start Code -->
                        <pre
                          class="line-numbers"
                        ><code class="language-javascript">// Display task data
function displayData(checklistArray) {
  const myTemplate = document.getElementById('Data-Template');
  const resultsBody = document.getElementById('resultsBody');

  // clear table first
  resultsBody.innerHTML = '';

  // Number format reference https://www.w3schools.com/jsref/jsref_tolocalestring_number.asp
  for (let i = 0; i < checklistArray.length; i++) {
    const dataRow = document.importNode(myTemplate.content, true);

    // Checkbox
    let isChecked = checklistArray[i].complete;
    let chkValue = isChecked ? 'checked' : '';
    let checkbox = `<input onClick="toggleComplete(this)" type="checkbox" name="chkComplete" id="chkComplete" ${chkValue}/>`;

    dataRow.getElementById('complete').innerHTML = checkbox;

    dataRow.getElementById('id').textContent = checklistArray[i].id;
    dataRow.getElementById('task').textContent = checklistArray[i].task;
    dataRow.getElementById('createdDate').textContent = formatDate(
      checklistArray[i].createdDate
    );
    dataRow.getElementById('dueDate').textContent = formatDate(
      checklistArray[i].dueDate
    );
    // dataRow.getElementById('controls').textContent = checklistArray[i].controls;

    resultsBody.appendChild(dataRow);
  }
}
</code></pre>
                        <!-- End Code -->

                        <!-- Start Code -->
                        <pre
                          class="line-numbers"
                        ><code class="language-javascript">// formatDate
function formatDate(strDate) {
  const date = new Date(strDate);
  const day = date.getDate(); // Returns the date
  const month = date.getMonth(); // Returns the month
  const year = date.getFullYear(); // Returns the year
  return `${month}/${day}/${year}`;
}
</code></pre>
                        <!-- End Code -->
                      </div>
                    </div>
                  </div>
                </div>
                <!-- End of Collapsible Sections -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer class="footer">
      <div class="container text-center">
        <span class="text-muted">&copy; Josue Cedeno 2021</span>
      </div>
    </footer>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>

    <!-- Prism -->
    <script src="/js/prism-twilight.js"></script>
  </body>
</html>
